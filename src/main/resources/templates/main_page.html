<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloud File Storage</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        .icon-actions {
            display: flex;
            justify-content: flex-start;
            gap: 15px;
            margin-bottom: 10px;
        }

        .icon-actions .icon {
            font-size: 1.8rem;
            color: #007bff;
            cursor: pointer;
        }

        .icon-actions .icon:hover {
            color: #0056b3;
        }

        .breadcrumb {
            background-color: #f8f9fa;
            padding: 10px 15px;
            border-radius: 5px;
        }

        .file-list {
            margin-top: 15px;
        }

        .file-icon {
            font-size: 1.5rem;
            color: #007bff;
            margin-right: 10px;
        }

        .folder-icon {
            font-size: 1.5rem;
            color: #28a745;
            margin-right: 10px;
        }

        .no-files {
            text-align: center;
            margin-top: 20px;
            color: #6c757d;
        }

        .search-bar {
            margin-bottom: 15px;
        }

    </style>
</head>

<body>
<!-- Header -->
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="/">CloudFileStorage</a>
    <div class="ml-auto">
        <strong th:text="${#authentication.name}"></strong>
        <form th:action="@{/auth/logout}" th:method="post" class="d-inline">
            <button type="submit" class="btn btn-outline-danger ml-2">Logout</button>
        </form>
    </div>
</nav>

<div class="container mt-4">
    <!-- Search Bar -->
    <div class="search-bar">
        <form th:action="@{/search}" method="get" class="form-inline">
            <input type="text" name="query" class="form-control mr-2 w-75" placeholder="Search files or folders"
                   required>
            <button type="submit" class="btn btn-primary">Search</button>
        </form>
    </div>

    <!-- Icons for actions -->
    <div class="icon-actions">
        <!-- Upload Icon -->
        <form th:action="@{/resources/upload}" th:method="POST" enctype="multipart/form-data" style="display: inline;">
            <input type="hidden" name="userId" th:value="${#authentication.getPrincipal().getId()}">
            <input type="hidden" name="path" th:value="${currentPath}">
            <label for="uploadFile" class="icon">üì§</label>
            <input type="file" name="files" id="uploadFile" class="d-none" multiple required>
        </form>

        <!-- Create Folder Icon -->
        <span class="icon" data-toggle="modal" data-target="#createFolderModal">üìÅ+</span>
    </div>

    <!-- Breadcrumbs -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a th:href="@{/}">Root</a></li>
            <li th:each="crumb, stat : ${breadcrumbs}" th:classappend="${stat.last ? 'active' : ''}"
                class="breadcrumb-item">
                <a th:if="${!stat.last}" th:href="@{/(path=${crumb.path})}" th:text="${crumb.name}"></a>
                <span th:if="${stat.last}" th:text="${crumb.name}"></span>
            </li>
        </ol>
    </nav>

    <!-- File List -->
    <div th:if="${files.isEmpty()}" class="no-files">
        <p>You have no files or folders yet.</p>
    </div>
    <table class="table table-hover file-list" th:if="${!files.isEmpty()}">
        <thead>
        <tr>
            <th>Name</th>
            <th class="text-right">Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="file : ${files}" th:class="${file.isFolder} ? 'table-info' : ''">
            <td>
                <span th:if="${file.isFolder}" class="folder-icon">üìÅ</span>
                <span th:if="${!file.isFolder}" class="file-icon">üìÑ</span>
                <a th:href="@{/(path=${file.path})}" th:text="${file.name}"></a>
            </td>
            <td class="text-right">
                <a th:href="@{/resources/download(path=${file.path})}" class="btn btn-sm btn-success">Download</a>
                <a th:href="@{/resources/delete(path=${file.path})}" class="btn btn-sm btn-danger">Delete</a>
                <button class="btn btn-sm btn-secondary" data-toggle="modal" data-target="#renameModal"
                        th:attr="data-path=${file.path}">Rename
                </button>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<!-- Create Folder Modal -->
<div class="modal fade" id="createFolderModal" tabindex="-1" role="dialog" aria-labelledby="createFolderModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Create New Folder</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form th:action="@{/resources/create-folder}" th:method="POST">
                <div class="modal-body">
                    <input type="hidden" name="userId" th:value="${#authentication.getPrincipal().getId()}">
                    <input type="hidden" name="path" th:value="${currentPath}">
                    <div class="form-group">
                        <label for="name">Folder Name</label>
                        <input id="name" type="text" name="name" class="form-control"
                               placeholder="Enter folder name" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Folder</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Rename Modal -->
<div class="modal fade" id="renameModal" tabindex="-1" role="dialog" aria-labelledby="renameModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Rename File</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form th:action="@{/resources/rename}" th:method="POST">
                <div class="modal-body">
                    <input type="hidden" name="path" id="renamePath">
                    <div class="form-group">
                        <label for="newName">New Name</label>
                        <input type="text" name="newName" id="newName" class="form-control" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Rename</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>

    document.getElementById('uploadFile').addEventListener('change', function () {
        this.closest('form').submit();
    });
</script>
</body>

</html>
